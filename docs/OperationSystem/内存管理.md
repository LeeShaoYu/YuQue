# 内存管理

## 存储器工作原理



### 程序编译



### 程序链接



### 程序装载



## 连续存储管理

### 固定分区存储管理



### 可变分区存储管理



## 虚拟内存



### 内存分页



### MMU

内存管理单元（memory management unit，MMU）

### TLB

最简单的分页表系统通常维护一个帧表和一个分页表，帧表处理帧映射信息。分页表处理页的虚拟地址和物理帧的映射。还有一些辅助信息，如当前存在标识位(present bit)，**脏数据标识位** 或已修改的标识位，地址空间或 **进程ID** 信息。

辅助存储，比如硬盘可以用于增加物理内存。页可以调入和调出到物理内存和磁盘。当前存在标识位可以指出那些页在物理内存，哪些页在硬盘上。页可以指出如何处理这些不同页。是否从硬盘读取一个页，或把其他页从物理内存调出。页面的频繁更换，导致整个系统效率急剧下降，这个现象称为 **内存抖动（或颠簸）**。抖动一般是内存分配算法不好，内存太小引或者程序的算法不佳引起的。

脏数据标识位可以优化性能。一个页从硬盘调入到物理内存中，读取后调出，当页没有更改不需要写回硬盘。但是如果页在调入物理内存后被修改，会标记其为脏数据，意味着该页必需被写回备用存储。这种策略需要当页被调入到内存后，后备存储保留一份页的拷贝。有了脏数据标志位，一些页随时会同时存在于物理内存和后备存储中。

地址空间 或 进程ID 信息是必要的，内存管理系统需要知道页对应的进程。两个不同的进程可以使用两个相同的虚拟地址。分页表必需为两个进程提供不同的虚拟内存。用 **虚拟内存页关联进程ID** 页可以帮助选择要调出的页，当页关联到不活跃进程上，特别是那些主要代码页被调出的进程，相比活跃进程需要页的可能性会更小。

### 进程空间



### 进程内核空间



### 页面调度算法

- **FIFO算法**：先入先出，即淘汰最早调入的页面。
- **OPT(MIN)算法**：选未来最远将使用的页淘汰，是一种最优的方案，可以证明缺页数最小。可惜，MIN需要知道将来发生的事，只能在理论中存在，实际不可应用。
- **LRU(Least-Recently-Used)算法**：用过去的历史预测将来，选最近最长时间没有使用的页淘汰(也称最近最少使用)。性能最接近OPT。**与页面使用时间有关**。
- **LFU(Least Frequently Used)算法**：即最不经常使用页置换算法，要求在页置换时置换引用计数最小的页，因为经常使用的页应该有一个较大的引用次数。**与页面使用次数有关**。
- **Clock**：给每个页帧关联一个使用位，当该页第一次装入内存或者被重新访问到时，将使用位置为1。每次需要替换时，查找使用位被置为0的第一个帧进行替换。在扫描过程中，如果碰到使用位为1的帧，将使用位置为0，在继续扫描。如果所谓帧的使用位都为0，则替换第一个帧。

